<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>desarrollo.views &mdash; documentación de SGP - 2</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="documentación de SGP - 2" href="../../index.html" />
    <link rel="up" title="Código de módulo" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li><a href="../../index.html">documentación de SGP - 2</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Código de módulo</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Código fuente para desarrollo.views</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">RequestContext</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">desarrollo.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">reversion</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">import</span> <span class="nn">pydot</span>
<span class="kn">from</span> <span class="nn">gestion.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gestion.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/iniciar_sesion&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="desarrollo"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desarrollo">[documentos]</a><span class="k">def</span> <span class="nf">desarrollo</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :return:</span>

<span class="sd">    Vista que muestra el contenido privado del modulo de desarrollo</span>

<span class="sd">    | Recibe como parametro un request y retorna la pagina web desarrollo.html donde se muestra la</span>
<span class="sd">    | lista de proyectos del sistema si el usuario posee los permisos correspondientes</span>

<span class="sd">    * Variables</span>
<span class="sd">        -   lista_proyectos: es la lista de proyectos existentes en el sistema</span>
<span class="sd">        -   usuario: es el usuario logueado</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lista_proyectos</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Usuarios</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;desarrollo.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;lista_proyectos&#39;</span><span class="p">:</span> <span class="n">lista_proyectos</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="des_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.des_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">des_proyecto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :return: La vista donde se visualizan las fases del proyecto del cual el usuario es participe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">generar_grafo_proyecto</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">lista_fases</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">lista_fases</span><span class="p">:</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lista_items</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_proyecto.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span> <span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;lista_fases&#39;</span><span class="p">:</span> <span class="n">lista_fases</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="des_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.des_fase">[documentos]</a><span class="k">def</span> <span class="nf">des_fase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :return: La vista donde se visualizan los items de la fase de la cual el usuario es participe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="crear_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.crear_item">[documentos]</a><span class="k">def</span> <span class="nf">crear_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :return: Una nueva instancia de item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">Usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">,</span> <span class="n">Version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lista_tipos</span> <span class="o">=</span> <span class="n">TipoDeItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque no ha iniciado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque ha finalizado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque ha sido cancelado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">Tipo</span><span class="o">.</span><span class="n">Atributos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">campo</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">tipoItem</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Tipo</span><span class="p">,</span> <span class="n">atributo</span><span class="o">=</span><span class="n">atributo</span><span class="p">)</span>
                <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;El item se ha creado exitosamente, no olvides completar los atributos&quot;</span>
            <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
            <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
                 <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
                 <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/crear_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_tipos&#39;</span><span class="p">:</span><span class="n">lista_tipos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="mod_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.mod_item">[documentos]</a><span class="k">def</span> <span class="nf">mod_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return: Una instancia del item seleccionado con los cambios realizados</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">boolean_solicitud</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">lista_tipos</span> <span class="o">=</span> <span class="n">TipoDeItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">CREDENCIAL</span><span class="p">:</span>
        <span class="n">solicitudes</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">ACEPTADA</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="n">boolean</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">solicitud</span> <span class="ow">in</span> <span class="n">solicitudes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">):</span>
                <span class="n">boolean</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">boolean</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Usted no posee permiso para modificar este item&#39;</span>
            <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">CREDENCIAL</span><span class="p">:</span>
        <span class="n">boolean_solicitud</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span>
    <span class="n">formulario1</span> <span class="o">=</span> <span class="n">ModItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">formulario1</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Nombre</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">NUMERICO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">numerico</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">CADENA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">cadena</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">FECHA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">fecha</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">TEXTO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">texto</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">LOGICO</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;1&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;2&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;3&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">MAIL</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">HORA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">hora</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">formulario1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">boolean_solicitud</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">solicitudes</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">ACEPTADA</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">solicitud</span> <span class="ow">in</span> <span class="n">solicitudes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                        <span class="n">solicitud</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">EJECUTADA</span>
                        <span class="n">solicitud</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;El item se ha modificado exitosamente&quot;</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
             <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
             <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
             <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario1</span> <span class="o">=</span> <span class="n">ModItemForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/mod_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario1</span><span class="p">,</span>
         <span class="s">&#39;lista_tipos&#39;</span><span class="p">:</span> <span class="n">lista_tipos</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="completar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.completar_item">[documentos]</a><span class="k">def</span> <span class="nf">completar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return: Una vista donce se puede acceder a los diferentes atributos del item y modificarlos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Nombre</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">NUMERICO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">numerico</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">CADENA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">cadena</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">FECHA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">fecha</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">TEXTO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">texto</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">LOGICO</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;1&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;2&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;3&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">MAIL</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">HORA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">hora</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;Atributos modificados exitosamente&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="c">#else:</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/com_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span><span class="n">campos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="detalle_item_vista"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_item_vista">[documentos]</a><span class="k">def</span> <span class="nf">detalle_item_vista</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param idProyecto:</span>
<span class="sd">    :param idFase:</span>
<span class="sd">    :param idItem:</span>
<span class="sd">    :return: Una vista en la que se muestran todas las caracteristicas de un item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span><span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/detalle.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span>
         <span class="s">&#39;hijos&#39;</span><span class="p">:</span> <span class="n">lista_hijos</span><span class="p">,</span> <span class="s">&#39;sucesores&#39;</span><span class="p">:</span> <span class="n">lista_sucesores</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="conf_eliminar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.conf_eliminar_item">[documentos]</a><span class="k">def</span> <span class="nf">conf_eliminar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param idProyecto:</span>
<span class="sd">    :param idFase:</span>
<span class="sd">    :param idItem:</span>
<span class="sd">    :return: Una vista donde se cuestiona al usuario la decision de eliminar o no un item de la fase</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if hijos(item) or sucesores(item):</span>
<span class="sd">        mensaje = &#39;El item &#39;+item.Nombre+&#39; no se puede eliminar porque posee hijos o sucesores&#39;</span>
<span class="sd">        suceso = False</span>
<span class="sd">        generar_grafo_fase(idFase)</span>
<span class="sd">        p_consultar = usuario.tienePermisoProyecto(&quot;consulta_item&quot;, idProyecto)</span>
<span class="sd">        p_revivir = usuario.tienePermisoProyecto(&quot;revive_item&quot;, idProyecto)</span>
<span class="sd">        p_aprobar = usuario.tienePermisoProyecto(&quot;aprueba_item&quot;,idProyecto)</span>
<span class="sd">        p_desaprobar = usuario.tienePermisoProyecto(&quot;desaprueba_item&quot;,idProyecto)</span>
<span class="sd">        p_eliminar_item = usuario.tienePermisoProyecto(&quot;delete_item&quot;,idProyecto)</span>
<span class="sd">        p_gestionar_item = usuario.tienePermisoProyecto(&quot;change_item&quot;,idProyecto)</span>
<span class="sd">        p_crear_item = usuario.tienePermisoProyecto(&quot;add_item&quot;,idProyecto)</span>
<span class="sd">        p_solicitar_cambio = usuario.tienePermisoProyecto(&quot;solicita_item&quot;,idProyecto)</span>
<span class="sd">        try:</span>
<span class="sd">            comite = ComiteDeCambio.objects.get(Proyecto=fase.Proyecto.id)</span>
<span class="sd">        except ObjectDoesNotExist:</span>
<span class="sd">            comite = False</span>
<span class="sd">        items_validados = Item.objects.filter(Fase=fase).filter(Estado=Item.VALIDADO)</span>
<span class="sd">        if items_validados == None:</span>
<span class="sd">            items_validados = True</span>

<span class="sd">        return render_to_response(</span>
<span class="sd">        &#39;des_fase.html&#39;,</span>
<span class="sd">        {&#39;usuario_actor&#39;: usuario, &#39;fase&#39;: fase,&#39;lista_items&#39;:lista_items,&#39;p_consultar&#39;:p_consultar, &#39;p_revivir&#39;:p_revivir, &#39;p_aprobar&#39;:p_aprobar,</span>
<span class="sd">         &#39;p_desaprobar&#39;: p_desaprobar, &#39;p_eliminar_item&#39;:p_eliminar_item, &#39;p_gestionar_item&#39;:p_gestionar_item,&#39;p_crear_item&#39;:p_crear_item,&#39;comite&#39;: comite, &#39;validados&#39;: items_validados,</span>
<span class="sd">         &#39;p_solicitar_cambio&#39;:p_solicitar_cambio,&#39;mensaje&#39;: mensaje, &#39;suceso&#39;:suceso}, context_instance=RequestContext(request)</span>
<span class="sd">        )</span>
<span class="sd">    else:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/conf_eliminar_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="eliminar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.eliminar_item">[documentos]</a><span class="k">def</span> <span class="nf">eliminar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param idProyecto:</span>
<span class="sd">    :param idFase:</span>
<span class="sd">    :param idItem:</span>
<span class="sd">    :return: Una vista donde sedel proyecto pueden visualizar los items que no han sido eliminados, en consecuencia no</span>
<span class="sd">            se observara el item previamente eliminado</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>

    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c">#Seteamos las relaciones de los hijos del item a ELIMINADO#</span>
    <span class="n">lista_hijo</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hijo</span> <span class="ow">in</span> <span class="n">lista_hijo</span><span class="p">:</span>
        <span class="n">hijo</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
        <span class="n">hijo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c">#Seteamos las relaciones de los sucesores del item a ELIMINADO#</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sucesor</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="n">sucesor</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
        <span class="n">sucesor</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;El item &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; se ha eliminado exitosamente&#39;</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="revivir_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.revivir_item">[documentos]</a><span class="k">def</span> <span class="nf">revivir_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :return: Una vista donde se muestra la lista de items eliminados por los diferentes usuarios que trabajan en la fase</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    lista_eliminados = reversion.get_deleted(Item)</span>
<span class="sd">    lista_items=[]</span>

<span class="sd">    for item in lista_eliminados:</span>
<span class="sd">       for key,value in item.field_dict.iteritems():</span>
<span class="sd">           if key == &#39;Fase&#39; and value == int(id_fase):</span>
<span class="sd">                lista_items.append(item)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/items_eliminados.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="item_revivido"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.item_revivido">[documentos]</a><span class="k">def</span> <span class="nf">item_revivido</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span>  <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_version</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_version:</span>
<span class="sd">    :return: Una vista donde se muestra la lista de items que no han sido eliminados, en consecuencia el item previamente</span>
<span class="sd">            seleccionado pasara a ocupar un lugar en esa lista</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_version</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span>
    <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">estado_padre</span><span class="p">()</span> <span class="ow">or</span> <span class="n">relacion</span><span class="o">.</span><span class="n">estado_antecesor</span><span class="p">():</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="c">#Seteamos las relaciones de los hijos del item a ACTIVO#</span>
    <span class="n">lista_hijo</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hijo</span> <span class="ow">in</span> <span class="n">lista_hijo</span><span class="p">:</span>
        <span class="c">#agregar el control de ciclo</span>
        <span class="k">if</span> <span class="n">hijo</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">hijo</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span>
            <span class="n">hijo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">generaCiclo</span><span class="p">(</span><span class="n">hijo</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
                <span class="n">hijo</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
                <span class="n">hijo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c">#Seteamos las relaciones de los sucesores del item a ACTIVO#</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sucesor</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="c">#agregar el control de ciclo</span>
        <span class="k">if</span> <span class="n">sucesor</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">sucesor</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span>
            <span class="n">sucesor</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>



    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span><span class="o">=</span> <span class="s">&#39;Item revivido&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="generar_grafo_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_proyecto</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :return: Una imagen de extension PNG en el cual se muestra una grafica representando al proyecto, sus fases y los</span>
<span class="sd">            diferentes items con sus respectivos estados</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fases_proyecto</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="n">relaciones_proyecto</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;record&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">fases_proyecto</span><span class="p">:</span>
        <span class="n">nombreFase</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#8AD4FF&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">FINALIZADO</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#1EED40&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;REV&quot;</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#F7F245&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;CRE&quot;</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#FC8702&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">r_temporal</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r_temporal</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
                        <span class="n">relaciones_proyecto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_temporal</span><span class="p">)</span>
        <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_proyecto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>

    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span> <span class="o">+</span> <span class="s">&#39;/static/media/grafoProyectoActual.png&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generar_grafo_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_fase">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param id_fase:</span>
<span class="sd">    :return: Una imagen de extension PNG en el cual se muestra una grafica representando la fase y los</span>
<span class="sd">            diferentes items con sus respectivos estados</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">relaciones_fase</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;component&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
    <span class="n">nombreFase</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;VAL&quot;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#8AD4FF&quot;</span><span class="p">))</span> <span class="c"># azul claro</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;FIN&quot;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#1EED40&quot;</span><span class="p">))</span> <span class="c"># verde claro</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;REV&quot;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#F7F245&quot;</span><span class="p">))</span> <span class="c"># amarillo claro</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;CRE&quot;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;#FC8702&quot;</span><span class="p">))</span> <span class="c"># naranja claro</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">r_temporal</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r_temporal</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
                        <span class="n">relaciones_fase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_temporal</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_fase</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>

    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span> <span class="o">+</span> <span class="s">&#39;/static/media/grafoFaseActual.png&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generar_grafo_calculo_impacto_costo_unitario"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_calculo_impacto_costo_unitario">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_calculo_impacto_costo_unitario</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return: Una imagen de extension PNG en el cual se muestra una grafica representando al proyecto, sus fases y los</span>
<span class="sd">            diferentes items con sus respectivos estados</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fases_proyecto</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="n">relaciones_proyecto</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;record&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">fases_proyecto</span><span class="p">:</span>
        <span class="n">nombreFase</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">pk</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">r_temporal</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r_temporal</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
                        <span class="n">relaciones_proyecto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_temporal</span><span class="p">)</span>
        <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_proyecto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s">&#39;/static/media/grafoImpactoUnitario.png&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generar_grafo_calculo_impacto_costo_temporal"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_calculo_impacto_costo_temporal">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_calculo_impacto_costo_temporal</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return: Una imagen de extension PNG en el cual se muestra una grafica representando al proyecto, sus fases y los</span>
<span class="sd">            diferentes items con sus respectivos estados</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fases_proyecto</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="n">relaciones_proyecto</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;record&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">fases_proyecto</span><span class="p">:</span>
        <span class="n">nombreFase</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">nombreFase</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">pk</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;C. Temporal: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;C. Temporal: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span><span class="p">)</span>
                                            <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">r_temporal</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r_temporal</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
                        <span class="n">relaciones_proyecto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_temporal</span><span class="p">)</span>
        <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_proyecto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoTemporal</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoTemporal</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s">&#39;/static/media/grafoImpactoTemporal.png&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="historial_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.historial_item">[documentos]</a><span class="k">def</span> <span class="nf">historial_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return: Una vista donde se pueden visualizar las diferentes versiones por la que paso  un item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">lista_versiones</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_unique_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_versiones</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">field_dict</span><span class="p">[</span><span class="s">&#39;Version&#39;</span><span class="p">]</span>
        <span class="k">break</span>


    <span class="n">lista</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_versiones</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">field_dict</span><span class="p">[</span><span class="s">&#39;condicion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">lista</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    for version in lista_versiones:</span>
<span class="sd">        print version.field_dict[&#39;Version&#39;]</span>
<span class="sd">        print c</span>
<span class="sd">        if version.field_dict[&#39;Version&#39;] &lt;= c:</span>
<span class="sd">            print &#39;entre&#39;</span>
<span class="sd">            c -= 1</span>
<span class="sd">            lista.append(version)</span>
<span class="sd">        else:</span>
<span class="sd">            lista.pop()</span>
<span class="sd">            lista.append(version)</span>
<span class="sd">    &quot;&quot;&quot;</span>




    <span class="n">p_reversionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;reversiona_item&quot;</span><span class="p">,</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/historial_item.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;lista_versiones&#39;</span><span class="p">:</span> <span class="n">lista</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span>
                                                                            <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">),</span>
                                                                            <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">),</span> <span class="s">&#39;p_reversionar_item&#39;</span><span class="p">:</span><span class="n">p_reversionar_item</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="reversion_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.reversion_item">[documentos]</a><span class="k">def</span> <span class="nf">reversion_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span>  <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_version</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :param id_version:</span>
<span class="sd">    :return: Una instacia de item con sus configuraciones internas de acuerdo al momento en que se genero dicha version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">version_antigua</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Version</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Se ha reversionado el item &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_atributos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Version</span>
    <span class="n">id_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">id_version</span><span class="p">)</span>
    <span class="n">version_item</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_unique_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_version</span><span class="p">:</span>
            <span class="n">version_item</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span>
            <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">lista_atributos</span><span class="p">:</span>
        <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">atributo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">version_item</span><span class="p">:</span>
                <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">version_item</span><span class="p">:</span>
            <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="n">version_antigua</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="detalle_item_version"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_item_version">[documentos]</a><span class="k">def</span> <span class="nf">detalle_item_version</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">,</span> <span class="n">idVersion</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param idProyecto:</span>
<span class="sd">    :param idFase:</span>
<span class="sd">    :param idItem:</span>
<span class="sd">    :param idVersion:</span>
<span class="sd">    :return: Una vista donde se pueden visualizar las diferentes versiones por la que paso  un item y sus detalles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="n">lista_version_item</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_version_relacion</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span>
    <span class="n">lista_atributos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="n">idn_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">idVersion</span><span class="p">)</span>
    <span class="n">revision_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">item_version</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">relacion_version</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version_item</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">idn_version</span><span class="p">:</span>
            <span class="n">item_version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="n">revision_id</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span>

    <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">lista_atributos</span><span class="p">:</span>
        <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">atributo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">revision_id</span><span class="p">:</span>
                <span class="n">campos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version_relacion</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">revision_id</span><span class="p">:</span>
            <span class="n">relacion_version</span> <span class="o">=</span> <span class="n">version</span>


    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/detalle_version.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;campo_version&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">,</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item_version&#39;</span><span class="p">:</span><span class="n">item_version</span><span class="p">,</span> <span class="s">&#39;relacion_version&#39;</span><span class="p">:</span><span class="n">relacion_version</span><span class="p">,</span><span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">lista_atributos</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="gestion_relacion_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.gestion_relacion_view">[documentos]</a><span class="k">def</span> <span class="nf">gestion_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span>
         <span class="s">&#39;hijos&#39;</span><span class="p">:</span> <span class="n">lista_hijos</span><span class="p">,</span> <span class="s">&#39;sucesores&#39;</span><span class="p">:</span> <span class="n">lista_sucesores</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="asignar_padre_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.asignar_padre_view">[documentos]</a><span class="k">def</span> <span class="nf">asignar_padre_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">itemTemp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
        <span class="n">itemTemp</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">PadreForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">relacion</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">generaCiclo</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;padre&#39;</span><span class="p">]):</span>
                <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">padre</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;padre&#39;</span><span class="p">]))</span>
                <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Error: El item &#39;</span><span class="o">+</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; no puede ser padre del item &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; , porque la relacion genera un ciclo&#39;</span>
                <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">=</span> <span class="n">itemTemp</span>
                <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Padre asignado exitosamente&#39;</span>
                <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                        <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span>
                 <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">PadreForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/asignar_padre.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="generaCiclo"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generaCiclo">[documentos]</a><span class="k">def</span> <span class="nf">generaCiclo</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span><span class="n">id_padre</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param id_item:</span>
<span class="sd">    :param id_padre:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">itemPadre</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_padre</span><span class="p">)</span>
    <span class="n">id_item</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="n">itemPadre</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">itemPadre</span><span class="o">.</span><span class="n">pk</span> <span class="o">==</span> <span class="n">id_item</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">itemPadre</span><span class="p">,</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">)</span>
            <span class="n">itemPadre</span> <span class="o">=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">False</span>

</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="asignar_antecesor_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.asignar_antecesor_view">[documentos]</a><span class="k">def</span> <span class="nf">asignar_antecesor_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span>

    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">Numero</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">faseAnterior</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">,</span> <span class="n">Numero</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Numero</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">faseAnterior</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">AntecesorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">relacion</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
            <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Antecesor asignado exitosamente&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">AntecesorForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/asignar_antecesor.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="gestion_archivos_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.gestion_archivos_view">[documentos]</a><span class="k">def</span> <span class="nf">gestion_archivos_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">lista_archivos</span> <span class="o">=</span> <span class="n">Archivo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;archivo/gestion_archivos.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;lista_archivos&#39;</span><span class="p">:</span> <span class="n">lista_archivos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="agregar_archivo_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.agregar_archivo_view">[documentos]</a><span class="k">def</span> <span class="nf">agregar_archivo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">archivo</span> <span class="o">=</span> <span class="n">Archivo</span><span class="p">()</span>
    <span class="n">archivo</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ArchivoForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">archivo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Archivo asignado exitosamente&#39;</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">lista_archivos</span> <span class="o">=</span> <span class="n">Archivo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span>  <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;archivo/gestion_archivos.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">,</span>
                 <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;lista_archivos&#39;</span><span class="p">:</span> <span class="n">lista_archivos</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ArchivoForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;archivo/agregar_archivo.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="detalle_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_fase">[documentos]</a><span class="k">def</span> <span class="nf">detalle_fase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :return:</span>

<span class="sd">    Vista detalle fase</span>

<span class="sd">    | Recibe como parametros un request, un id de fase y un id de proyecto, y retorna la pagina web</span>
<span class="sd">    | detallefase.html que muestra en detalle la informacion de dicha fase</span>

<span class="sd">    * Variables</span>
<span class="sd">        -   usuario_actor: usuario que realiza la accion</span>
<span class="sd">        -   proyecto: es el proyecto cuyas fases se desea administrar</span>
<span class="sd">        -   fases: indica que la fase correpondera a un proyecto especifico</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario_actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;detalle_fase.html&#39;</span><span class="p">,</span>
                              <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario_actor</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="detalle_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">detalle_proyecto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario_actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;detalle_proyecto_des.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario_actor</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span> <span class="n">proyecto</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sucesores"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.sucesores">[documentos]</a><span class="k">def</span> <span class="nf">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sucesores</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">antecesor</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sucesores</span>
</div>
<div class="viewcode-block" id="hijos"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.hijos">[documentos]</a><span class="k">def</span> <span class="nf">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hijos</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">padre</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hijos</span>
</div>
<div class="viewcode-block" id="impacto_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.impacto_view">[documentos]</a><span class="k">def</span> <span class="nf">impacto_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">costo_m_atras</span> <span class="o">=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_m_adelante</span> <span class="o">=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_monetario_total</span> <span class="o">=</span> <span class="n">costo_m_atras</span> <span class="o">+</span> <span class="n">costo_m_adelante</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
    <span class="n">costo_t_atras</span> <span class="o">=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_t_adelante</span> <span class="o">=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_temporal_total</span> <span class="o">=</span> <span class="n">costo_t_atras</span> <span class="o">+</span> <span class="n">costo_t_adelante</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
    <span class="n">generar_grafo_calculo_impacto_costo_temporal</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">,</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">generar_grafo_calculo_impacto_costo_unitario</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">,</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/impacto.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;costo_monetario_atras&#39;</span><span class="p">:</span> <span class="n">costo_m_atras</span><span class="p">,</span>
         <span class="s">&#39;costo_monetario_adelante&#39;</span><span class="p">:</span> <span class="n">costo_m_adelante</span><span class="p">,</span> <span class="s">&#39;costo_temporal_atras&#39;</span><span class="p">:</span> <span class="n">costo_t_atras</span><span class="p">,</span>
         <span class="s">&#39;costo_temporal_adelante&#39;</span><span class="p">:</span> <span class="n">costo_t_adelante</span><span class="p">,</span> <span class="s">&#39;costo_monetario_total&#39;</span><span class="p">:</span> <span class="n">costo_monetario_total</span><span class="p">,</span>
         <span class="s">&#39;costo_temporal_total&#39;</span><span class="p">:</span> <span class="n">costo_temporal_total</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="costo_monetario_atras"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_monetario_atras">[documentos]</a><span class="k">def</span> <span class="nf">costo_monetario_atras</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoUnitario</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoUnitario</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_monetario_adelante"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_monetario_adelante">[documentos]</a><span class="k">def</span> <span class="nf">costo_monetario_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lista_hijos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_temporal_atras"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_temporal_atras">[documentos]</a><span class="k">def</span> <span class="nf">costo_temporal_atras</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoTemporal</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoTemporal</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_temporal_adelante"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_temporal_adelante">[documentos]</a><span class="k">def</span> <span class="nf">costo_temporal_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lista_hijos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">condicion</span> <span class="o">==</span> <span class="n">Item</span><span class="o">.</span><span class="n">ACTIVO</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="eliminar_relacion_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.eliminar_relacion_view">[documentos]</a><span class="k">def</span> <span class="nf">eliminar_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/eliminar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="relacion_eliminada_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.relacion_eliminada_view">[documentos]</a><span class="k">def</span> <span class="nf">relacion_eliminada_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Relacion eliminada con exito&#39;</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="aprobar_item_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.aprobar_item_view">[documentos]</a><span class="k">def</span> <span class="nf">aprobar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Estado</span> <span class="o">!=</span> <span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span> <span class="ow">and</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Estado</span> <span class="o">!=</span> <span class="n">Item</span><span class="o">.</span><span class="n">FINALIZADO</span><span class="p">:</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;El item no puede ser aprobado ya que su padre todavia no ha sido aprobado&#39;</span>
            <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
                 <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
                 <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">Numero</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">posee_antecesor</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;El item no posee antecesor directo ni indirecto, por lo tanto no puede ser aprobado&#39;</span>
            <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
                 <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
                 <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/finalizar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="item_finalizado_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.item_finalizado_view">[documentos]</a><span class="k">def</span> <span class="nf">item_finalizado_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>

    <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">FINALIZADO</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Item aprobado exitosamente&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>



</div>
<div class="viewcode-block" id="solicitud_crear_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.solicitud_crear_view">[documentos]</a><span class="k">def</span> <span class="nf">solicitud_crear_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">lista_items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="n">solicitud</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">,</span> <span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">SolicitudCambioForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">solicitud</span><span class="p">)</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">lista_items</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="s">&quot;Haga doble click en el item que desee agregar&quot;</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">solicitud</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">SOLICITUD</span>
                <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;Solicitud de cambio creada exitosamente&quot;</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">miembro</span> <span class="ow">in</span> <span class="n">comite</span><span class="o">.</span><span class="n">Miembros</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">voto</span> <span class="o">=</span> <span class="n">Voto</span><span class="p">()</span>
                <span class="n">voto</span><span class="o">.</span><span class="n">solicitud</span> <span class="o">=</span> <span class="n">solicitud</span>
                <span class="n">voto</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="n">miembro</span>
                <span class="n">voto</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
                 <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
                 <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">SolicitudCambioForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">solicitud</span><span class="p">)</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">lista_items</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="s">&quot;Haga doble click en el item que desee agregar&quot;</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;solicitud.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span><span class="n">formulario</span><span class="p">,</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="desaprobar_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desaprobar_view">[documentos]</a><span class="k">def</span> <span class="nf">desaprobar_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/desaprobar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="desaprobado_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desaprobado_view">[documentos]</a><span class="k">def</span> <span class="nf">desaprobado_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">CONSTRUCCION</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Item desaprobado exitosamente&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="solicitudes_de_cambio_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.solicitudes_de_cambio_view">[documentos]</a><span class="k">def</span> <span class="nf">solicitudes_de_cambio_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span>  <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">solicitudes</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;solicitudes.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span><span class="s">&#39;solicitudes&#39;</span><span class="p">:</span><span class="n">solicitudes</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="detalle_solicitud"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_solicitud">[documentos]</a><span class="k">def</span> <span class="nf">detalle_solicitud</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_solicitud</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_solicitud:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span>  <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">solicitud</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_solicitud</span><span class="p">)</span>
    <span class="n">lista_item</span> <span class="o">=</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;detalle_solicitud_des.html&#39;</span><span class="p">,{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span><span class="s">&#39;solicitud&#39;</span><span class="p">:</span><span class="n">solicitud</span><span class="p">,</span> <span class="s">&#39;lista_item&#39;</span><span class="p">:</span><span class="n">lista_item</span><span class="p">}</span>
                              <span class="p">,</span><span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="posee_antecesor"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.posee_antecesor">[documentos]</a><span class="k">def</span> <span class="nf">posee_antecesor</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">while</span> <span class="n">relacion</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="revisar_item_vista"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.revisar_item_vista">[documentos]</a><span class="k">def</span> <span class="nf">revisar_item_vista</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="n">Relacion</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Estado</span> <span class="o">!=</span> <span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">:</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No se puede revisar el item porque el padre aun no se ha modificado&#39;</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
        <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
             <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
             <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
             <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="n">solicitudes</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">ACEPTADA</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">boolean</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">solicitud</span> <span class="ow">in</span> <span class="n">solicitudes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="n">boolean</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">solicitudes</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">EJECUTADA</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">solicitud</span> <span class="ow">in</span> <span class="n">solicitudes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">solicitud</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="n">boolean</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">boolean</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Usted no posee permiso para modificar este item&#39;</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
        <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
             <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span>
             <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span> <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span> <span class="n">p_eliminar_item</span><span class="p">,</span>
             <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
             <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/revisar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span>
         <span class="s">&#39;hijos&#39;</span><span class="p">:</span> <span class="n">lista_hijos</span><span class="p">,</span> <span class="s">&#39;sucesores&#39;</span><span class="p">:</span> <span class="n">lista_sucesores</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="item_revisado_vista"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.item_revisado_vista">[documentos]</a><span class="k">def</span> <span class="nf">item_revisado_vista</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_item:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">version_Revisado</span> <span class="o">=</span> <span class="n">lista_version</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">&lt;</span> <span class="n">version_Revisado</span><span class="o">.</span><span class="n">revision_id</span><span class="p">:</span>
            <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>
            <span class="k">break</span>

    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;El item ha sido revisado&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condicion</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">ELIMINADO</span><span class="p">)</span>
    <span class="n">p_consultar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;consulta_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_revivir</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;revive_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_aprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;aprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_desaprobar</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;desaprueba_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_eliminar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;delete_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_gestionar_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;change_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_crear_item</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;add_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">p_solicitar_cambio</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">tienePermisoProyecto</span><span class="p">(</span><span class="s">&quot;solicita_item&quot;</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">,</span> <span class="s">&#39;p_consultar&#39;</span><span class="p">:</span><span class="n">p_consultar</span><span class="p">,</span> <span class="s">&#39;p_revivir&#39;</span><span class="p">:</span><span class="n">p_revivir</span><span class="p">,</span> <span class="s">&#39;p_aprobar&#39;</span><span class="p">:</span><span class="n">p_aprobar</span><span class="p">,</span>
         <span class="s">&#39;p_desaprobar&#39;</span><span class="p">:</span> <span class="n">p_desaprobar</span><span class="p">,</span> <span class="s">&#39;p_eliminar_item&#39;</span><span class="p">:</span><span class="n">p_eliminar_item</span><span class="p">,</span> <span class="s">&#39;p_gestionar_item&#39;</span><span class="p">:</span><span class="n">p_gestionar_item</span><span class="p">,</span><span class="s">&#39;p_crear_item&#39;</span><span class="p">:</span><span class="n">p_crear_item</span><span class="p">,</span>
         <span class="s">&#39;p_solicitar_cambio&#39;</span><span class="p">:</span><span class="n">p_solicitar_cambio</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Introduzca los términos de búsqueda o un nombre de módulo, clase o función.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li><a href="../../index.html">documentación de SGP - 2</a> &raquo;</li>
          <li><a href="../index.html" >Código de módulo</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Alexis Ojeda - Rodrigo Ferreira - Juan Figueredo.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>