<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>desarrollo.views &mdash; documentación de SGP - 2</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="documentación de SGP - 2" href="../../index.html" />
    <link rel="up" title="Código de módulo" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li><a href="../../index.html">documentación de SGP - 2</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Código de módulo</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Código fuente para desarrollo.views</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">RequestContext</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">desarrollo.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">reversion</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">import</span> <span class="nn">pydot</span>
<span class="kn">from</span> <span class="nn">gestion.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gestion.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/iniciar_sesion&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="desarrollo"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desarrollo">[documentos]</a><span class="k">def</span> <span class="nf">desarrollo</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :return:</span>

<span class="sd">    Vista que muestra el contenido privado del modulo de desarrollo</span>

<span class="sd">    | Recibe como parametro un request y retorna la pagina web desarrollo.html donde se muestra la</span>
<span class="sd">    | lista de proyectos del sistema si el usuario posee los permisos correspondientes</span>

<span class="sd">    * Variables</span>
<span class="sd">        -   lista_proyectos: es la lista de proyectos existentes en el sistema</span>
<span class="sd">        -   usuario: es el usuario logueado</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lista_proyectos</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;desarrollo.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;lista_proyectos&#39;</span><span class="p">:</span> <span class="n">lista_proyectos</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="des_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.des_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">des_proyecto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="n">generar_grafo_proyecto</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">lista_fases</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">lista_fases</span><span class="p">:</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lista_items</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_proyecto.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span> <span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;lista_fases&#39;</span><span class="p">:</span> <span class="n">lista_fases</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="des_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.des_fase">[documentos]</a><span class="k">def</span> <span class="nf">des_fase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">comite</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_validados</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">items_validados</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">items_validados</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;comite&#39;</span><span class="p">:</span> <span class="n">comite</span><span class="p">,</span> <span class="s">&#39;validados&#39;</span><span class="p">:</span> <span class="n">items_validados</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="crear_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.crear_item">[documentos]</a><span class="k">def</span> <span class="nf">crear_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">Usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">,</span> <span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">,</span> <span class="n">Version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lista_tipos</span> <span class="o">=</span> <span class="n">TipoDeItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque no ha iniciado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque ha finalizado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;No puedes crear items en el proyecto &#39;</span><span class="o">+</span><span class="n">fase</span><span class="o">.</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; porque ha sido cancelado&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">Tipo</span><span class="o">.</span><span class="n">Atributos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">campo</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">tipoItem</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Tipo</span><span class="p">,</span> <span class="n">atributo</span><span class="o">=</span><span class="n">atributo</span><span class="p">)</span>
                <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;El item se ha creado exitosamente, no olvides completar los atributos&quot;</span>
            <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/crear_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_tipos&#39;</span><span class="p">:</span><span class="n">lista_tipos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="mod_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.mod_item">[documentos]</a><span class="k">def</span> <span class="nf">mod_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_tipos</span> <span class="o">=</span> <span class="n">TipoDeItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;El item se ha modificado exitosamente&quot;</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ItemForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/mod_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;formulario&#39;</span><span class="p">:</span><span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;lista_tipos&#39;</span><span class="p">:</span> <span class="n">lista_tipos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="completar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.completar_item">[documentos]</a><span class="k">def</span> <span class="nf">completar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Nombre</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">NUMERICO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">numerico</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">CADENA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">cadena</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">FECHA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">fecha</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">TEXTO</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">texto</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">LOGICO</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;1&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;2&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;3&quot;</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">logico</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">MAIL</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">atributo</span><span class="o">.</span><span class="n">Tipo</span> <span class="o">==</span> <span class="n">Atributo</span><span class="o">.</span><span class="n">HORA</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">hora</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;Atributos modificados exitosamente&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">},</span>
            <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="c">#else:</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/com_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span><span class="n">campos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="detalle_item_vista"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_item_vista">[documentos]</a><span class="k">def</span> <span class="nf">detalle_item_vista</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idProyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/detalle.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>   <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="conf_eliminar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.conf_eliminar_item">[documentos]</a><span class="k">def</span> <span class="nf">conf_eliminar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span><span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="s">&#39;El item &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; no se puede eliminar porque posee hijos o sucesores&#39;</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/conf_eliminar_item.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="eliminar_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.eliminar_item">[documentos]</a><span class="k">def</span> <span class="nf">eliminar_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>

    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">campos</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="n">item</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">idFase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/item_exito.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span><span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span>
         <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="s">&#39;El item &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="o">+</span><span class="s">&#39; se ha eliminado exitosamente&#39;</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="revivir_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.revivir_item">[documentos]</a><span class="k">def</span> <span class="nf">revivir_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_eliminados</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_deleted</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lista_eliminados</span><span class="p">:</span>
       <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">field_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
           <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;Fase&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_fase</span><span class="p">):</span>
                <span class="n">lista_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/items_eliminados.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="item_revivido"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.item_revivido">[documentos]</a><span class="k">def</span> <span class="nf">item_revivido</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span>  <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_version</span><span class="p">):</span>

    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_eliminados</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_deleted</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">lista_eliminados</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_version</span><span class="p">)</span>

    <span class="n">id_revision</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">revision_id</span>
    <span class="n">item</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">lista_atributos_eliminados</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_deleted</span><span class="p">(</span><span class="n">Campo</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">lista_atributos_eliminados</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atributo</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">id_revision</span><span class="p">:</span>
            <span class="n">atributo</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">lista_relaciones_eliminadas</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_deleted</span><span class="p">(</span><span class="n">Relacion</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">lista_relaciones_eliminadas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">revision_id</span><span class="o">=</span><span class="n">id_revision</span><span class="p">)</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">IntegrityError</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">object_id</span><span class="p">))</span>




    <span class="n">mensaje</span><span class="o">=</span> <span class="s">&#39;Item revivido&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="generar_grafo_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_proyecto</span><span class="p">(</span><span class="n">id_proyecto</span><span class="p">):</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fases_proyecto</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
    <span class="n">relaciones_proyecto</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;record&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fase</span> <span class="ow">in</span> <span class="n">fases_proyecto</span><span class="p">:</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&lt;f0&gt;</span><span class="si">%s</span><span class="s">|&lt;f1&gt;Costo $: </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">)</span>
                                        <span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                <span class="n">relaciones_proyecto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>
        <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_proyecto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoUnitario</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s">&#39;/static/media/grafoProyectoActual.png&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generar_grafo_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generar_grafo_fase">[documentos]</a><span class="k">def</span> <span class="nf">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">):</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">relaciones_fase</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grafo</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s">&quot;LR&quot;</span><span class="p">,</span><span class="n">labelloc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_node_defaults</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;component&quot;</span><span class="p">)</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">set_edge_defaults</span><span class="p">(</span><span class="n">arrowhead</span><span class="o">=</span><span class="s">&quot;vee&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">graph_name</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">items_fase</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_fase</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">==</span> <span class="s">&quot;FIN&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
            <span class="n">relaciones_fase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">relaciones_fase</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">:</span>
            <span class="n">grafo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">relacion</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
    <span class="n">grafo</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s">&#39;/static/media/grafoFaseActual.png&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="historial_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.historial_item">[documentos]</a><span class="k">def</span> <span class="nf">historial_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">lista_versiones</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/historial_item.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;lista_versiones&#39;</span><span class="p">:</span> <span class="n">lista_versiones</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span>
                                                                            <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">),</span>
                                                                            <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="reversion_item"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.reversion_item">[documentos]</a><span class="k">def</span> <span class="nf">reversion_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span>  <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_version</span><span class="p">):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">version_antigua</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Version</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Se ha reversionado el item &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Nombre</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_atributos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Version</span>
    <span class="n">id_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">id_version</span><span class="p">)</span>
    <span class="n">version_item</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_version</span><span class="p">:</span>
            <span class="n">version_item</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span>
            <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">lista_atributos</span><span class="p">:</span>
        <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">atributo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">version_item</span><span class="p">:</span>
                <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">version_item</span><span class="p">:</span>
            <span class="n">version</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="n">version_antigua</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="detalle_item_version"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_item_version">[documentos]</a><span class="k">def</span> <span class="nf">detalle_item_version</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idProyecto</span><span class="p">,</span> <span class="n">idFase</span><span class="p">,</span> <span class="n">idItem</span><span class="p">,</span> <span class="n">idVersion</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idFase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">idItem</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="n">lista_version_item</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_version_relacion</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span>
    <span class="n">lista_atributos</span> <span class="o">=</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="n">idn_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">idVersion</span><span class="p">)</span>
    <span class="n">revision_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">item_version</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">relacion_version</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version_item</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">idn_version</span><span class="p">:</span>
            <span class="n">item_version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="n">revision_id</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span>

    <span class="k">for</span> <span class="n">atributo</span> <span class="ow">in</span> <span class="n">lista_atributos</span><span class="p">:</span>
        <span class="n">lista_version</span> <span class="o">=</span> <span class="n">reversion</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="n">atributo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">revision_id</span><span class="p">:</span>
                <span class="n">campos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">lista_version_relacion</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">revision_id</span> <span class="o">==</span> <span class="n">revision_id</span><span class="p">:</span>
            <span class="n">relacion_version</span> <span class="o">=</span> <span class="n">version</span>


    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/detalle_version.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;campo_version&#39;</span><span class="p">:</span> <span class="n">campos</span><span class="p">,</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item_version&#39;</span><span class="p">:</span><span class="n">item_version</span><span class="p">,</span> <span class="s">&#39;relacion_version&#39;</span><span class="p">:</span><span class="n">relacion_version</span><span class="p">,</span><span class="s">&#39;campos&#39;</span><span class="p">:</span> <span class="n">lista_atributos</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="gestion_relacion_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.gestion_relacion_view">[documentos]</a><span class="k">def</span> <span class="nf">gestion_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span>
         <span class="s">&#39;hijos&#39;</span><span class="p">:</span> <span class="n">lista_hijos</span><span class="p">,</span> <span class="s">&#39;sucesores&#39;</span><span class="p">:</span> <span class="n">lista_sucesores</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="asignar_padre_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.asignar_padre_view">[documentos]</a><span class="k">def</span> <span class="nf">asignar_padre_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">PadreForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">relacion</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">generaCiclo</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;padre&#39;</span><span class="p">]):</span>
                <span class="n">suceso</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Error: Esta relacion genera un ciclo&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Padre asignado exitosamente&#39;</span>
                <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span>
                 <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">PadreForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/asignar_padre.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="generaCiclo"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.generaCiclo">[documentos]</a><span class="k">def</span> <span class="nf">generaCiclo</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span><span class="n">id_padre</span><span class="p">):</span>
    <span class="n">itemPadre</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_padre</span><span class="p">)</span>
    <span class="n">id_item</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="n">itemPadre</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">itemPadre</span><span class="o">.</span><span class="n">pk</span> <span class="o">==</span> <span class="n">id_item</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">itemPadre</span><span class="p">)</span>
            <span class="n">itemPadre</span> <span class="o">=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">False</span>

</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="asignar_antecesor_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.asignar_antecesor_view">[documentos]</a><span class="k">def</span> <span class="nf">asignar_antecesor_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">Numero</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">faseAnterior</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">,</span> <span class="n">Numero</span><span class="o">=</span><span class="n">fase</span><span class="o">.</span><span class="n">Numero</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">faseAnterior</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">AntecesorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">relacion</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">item</span><span class="o">.</span><span class="n">Version</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">Campo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">):</span>
            <span class="n">campo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Antecesor asignado exitosamente&#39;</span>
        <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">AntecesorForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/asignar_antecesor.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span><span class="n">lista_items</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="gestion_archivos_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.gestion_archivos_view">[documentos]</a><span class="k">def</span> <span class="nf">gestion_archivos_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">lista_archivos</span> <span class="o">=</span> <span class="n">Archivo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;archivo/gestion_archivos.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;lista_archivos&#39;</span><span class="p">:</span> <span class="n">lista_archivos</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<span class="nd">@reversion.create_revision</span><span class="p">()</span>
<div class="viewcode-block" id="agregar_archivo_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.agregar_archivo_view">[documentos]</a><span class="k">def</span> <span class="nf">agregar_archivo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">archivo</span> <span class="o">=</span> <span class="n">Archivo</span><span class="p">()</span>
    <span class="n">archivo</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ArchivoForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">archivo</span><span class="p">)</span>

        <span class="k">print</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Archivo asignado exitosamente&#39;</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">lista_archivos</span> <span class="o">=</span> <span class="n">Archivo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span>  <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;archivo/gestion_archivos.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span><span class="n">suceso</span><span class="p">,</span>
                 <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;lista_archivos&#39;</span><span class="p">:</span> <span class="n">lista_archivos</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">ArchivoForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;archivo/agregar_archivo.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span> <span class="n">formulario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="detalle_fase"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_fase">[documentos]</a><span class="k">def</span> <span class="nf">detalle_fase</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param request:</span>
<span class="sd">    :param id_fase:</span>
<span class="sd">    :param id_proyecto:</span>
<span class="sd">    :return:</span>

<span class="sd">    Vista detalle fase</span>

<span class="sd">    | Recibe como parametros un request, un id de fase y un id de proyecto, y retorna la pagina web</span>
<span class="sd">    | detallefase.html que muestra en detalle la informacion de dicha fase</span>

<span class="sd">    * Variables</span>
<span class="sd">        -   usuario_actor: usuario que realiza la accion</span>
<span class="sd">        -   proyecto: es el proyecto cuyas fases se desea administrar</span>
<span class="sd">        -   fases: indica que la fase correpondera a un proyecto especifico</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usuario_actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;detalle_fase.html&#39;</span><span class="p">,</span>
                              <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario_actor</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="detalle_proyecto"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.detalle_proyecto">[documentos]</a><span class="k">def</span> <span class="nf">detalle_proyecto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="n">usuario_actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;detalle_proyecto_des.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario_actor</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span> <span class="n">proyecto</span><span class="p">},</span>
                              <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sucesores"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.sucesores">[documentos]</a><span class="k">def</span> <span class="nf">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">sucesores</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">antecesor</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sucesores</span>
</div>
<div class="viewcode-block" id="hijos"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.hijos">[documentos]</a><span class="k">def</span> <span class="nf">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">hijos</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">padre</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hijos</span>
</div>
<div class="viewcode-block" id="impacto_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.impacto_view">[documentos]</a><span class="k">def</span> <span class="nf">impacto_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">costo_m_atras</span> <span class="o">=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_m_adelante</span> <span class="o">=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_monetario_total</span> <span class="o">=</span> <span class="n">costo_m_atras</span> <span class="o">+</span> <span class="n">costo_m_adelante</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
    <span class="n">costo_t_atras</span> <span class="o">=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_t_adelante</span> <span class="o">=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">costo_temporal_total</span> <span class="o">=</span> <span class="n">costo_t_atras</span> <span class="o">+</span> <span class="n">costo_t_adelante</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/impacto.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;costo_monetario_atras&#39;</span><span class="p">:</span> <span class="n">costo_m_atras</span><span class="p">,</span>
         <span class="s">&#39;costo_monetario_adelante&#39;</span><span class="p">:</span> <span class="n">costo_m_adelante</span><span class="p">,</span> <span class="s">&#39;costo_temporal_atras&#39;</span><span class="p">:</span> <span class="n">costo_t_atras</span><span class="p">,</span>
         <span class="s">&#39;costo_temporal_adelante&#39;</span><span class="p">:</span> <span class="n">costo_t_adelante</span><span class="p">,</span> <span class="s">&#39;costo_monetario_total&#39;</span><span class="p">:</span> <span class="n">costo_monetario_total</span><span class="p">,</span>
         <span class="s">&#39;costo_temporal_total&#39;</span><span class="p">:</span> <span class="n">costo_temporal_total</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="costo_monetario_atras"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_monetario_atras">[documentos]</a><span class="k">def</span> <span class="nf">costo_monetario_atras</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoUnitario</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoUnitario</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_monetario_adelante"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_monetario_adelante">[documentos]</a><span class="k">def</span> <span class="nf">costo_monetario_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lista_hijos</span><span class="p">:</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoUnitario</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_monetario_adelante</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_temporal_atras"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_temporal_atras">[documentos]</a><span class="k">def</span> <span class="nf">costo_temporal_atras</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="o">.</span><span class="n">CostoTemporal</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">padre</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="o">.</span><span class="n">CostoTemporal</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_atras</span><span class="p">(</span><span class="n">relacion</span><span class="o">.</span><span class="n">antecesor</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="costo_temporal_adelante"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.costo_temporal_adelante">[documentos]</a><span class="k">def</span> <span class="nf">costo_temporal_adelante</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lista_hijos</span> <span class="o">=</span> <span class="n">hijos</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">lista_sucesores</span> <span class="o">=</span> <span class="n">sucesores</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lista_hijos</span><span class="p">:</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">lista_sucesores</span><span class="p">:</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">CostoTemporal</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="n">costo_temporal_adelante</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cont</span>
</div>
<div class="viewcode-block" id="eliminar_relacion_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.eliminar_relacion_view">[documentos]</a><span class="k">def</span> <span class="nf">eliminar_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/eliminar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="relacion_eliminada_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.relacion_eliminada_view">[documentos]</a><span class="k">def</span> <span class="nf">relacion_eliminada_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Relacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Relacion eliminada con exito&#39;</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;relacion/gestion_relaciones.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span> <span class="n">relacion</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="finalizar_item_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.finalizar_item_view">[documentos]</a><span class="k">def</span> <span class="nf">finalizar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/finalizar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="item_finalizado_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.item_finalizado_view">[documentos]</a><span class="k">def</span> <span class="nf">item_finalizado_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">FINALIZADO</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Item aprobado exitosamente&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>


</div>
<div class="viewcode-block" id="solicitud_cambio_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.solicitud_cambio_view">[documentos]</a><span class="k">def</span> <span class="nf">solicitud_cambio_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">lista_items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Estado</span><span class="o">=</span><span class="n">Item</span><span class="o">.</span><span class="n">VALIDADO</span><span class="p">)</span>
    <span class="n">solicitud</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">,</span> <span class="n">usuario</span><span class="o">=</span><span class="n">usuario</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">SolicitudCambioForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">solicitud</span><span class="p">)</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">lista_items</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="s">&quot;Haga doble click en el item que desee agregar&quot;</span>
        <span class="k">if</span> <span class="n">formulario</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formulario</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">solicitud</span> <span class="o">=</span> <span class="n">SolicitudCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
            <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&quot;Solicitud de cambio creada exitosamente&quot;</span>
            <span class="n">comite</span> <span class="o">=</span> <span class="n">ComiteDeCambio</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Proyecto</span><span class="o">=</span><span class="n">proyecto</span><span class="p">)</span>
            <span class="n">voto1</span> <span class="o">=</span> <span class="n">Voto</span><span class="p">()</span>
            <span class="n">voto1</span><span class="o">.</span><span class="n">solicitud</span> <span class="o">=</span><span class="n">solicitud</span>
            <span class="n">voto1</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="n">comite</span><span class="o">.</span><span class="n">Usuario1</span>
            <span class="n">voto1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">voto2</span> <span class="o">=</span> <span class="n">Voto</span><span class="p">()</span>
            <span class="n">voto2</span><span class="o">.</span><span class="n">solicitud</span> <span class="o">=</span><span class="n">solicitud</span>
            <span class="n">voto2</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="n">comite</span><span class="o">.</span><span class="n">Usuario2</span>
            <span class="n">voto2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">voto3</span> <span class="o">=</span> <span class="n">Voto</span><span class="p">()</span>
            <span class="n">voto3</span><span class="o">.</span><span class="n">solicitud</span> <span class="o">=</span><span class="n">solicitud</span>
            <span class="n">voto3</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="n">comite</span><span class="o">.</span><span class="n">Usuario3</span>
            <span class="n">voto3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
                <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
                <span class="p">{</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">,</span>
                 <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span> <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">},</span>
                <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">formulario</span> <span class="o">=</span> <span class="n">SolicitudCambioForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">solicitud</span><span class="p">)</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">lista_items</span>
        <span class="n">formulario</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="s">&quot;Haga doble click en el item que desee agregar&quot;</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;solicitud.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;formulario&#39;</span><span class="p">:</span><span class="n">formulario</span><span class="p">,</span><span class="s">&#39;usuario_actor&#39;</span><span class="p">:</span><span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="desaprobar_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desaprobar_view">[documentos]</a><span class="k">def</span> <span class="nf">desaprobar_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;item/desaprobar.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="desaprobado_view"><a class="viewcode-back" href="../../desarrollo.html#desarrollo.views.desaprobado_view">[documentos]</a><span class="k">def</span> <span class="nf">desaprobado_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">Estado</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">CONSTRUCCION</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">suceso</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">mensaje</span> <span class="o">=</span> <span class="s">&#39;Item desaprobado exitosamente&#39;</span>
    <span class="n">lista_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Fase</span><span class="o">=</span><span class="n">fase</span><span class="p">)</span>
    <span class="n">generar_grafo_fase</span><span class="p">(</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
        <span class="s">&#39;des_fase.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;usuario&#39;</span><span class="p">:</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;suceso&#39;</span><span class="p">:</span> <span class="n">suceso</span><span class="p">,</span>
         <span class="s">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">,</span> <span class="s">&#39;lista_items&#39;</span><span class="p">:</span> <span class="n">lista_items</span><span class="p">},</span>
        <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Introduzca los términos de búsqueda o un nombre de módulo, clase o función.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li><a href="../../index.html">documentación de SGP - 2</a> &raquo;</li>
          <li><a href="../index.html" >Código de módulo</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Alexis Ojeda - Rodrigo Ferreira - Juan Figueredo.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>